<ion-header>
  <ion-toolbar>
    <ion-title>D√©tails du lieu</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding" *ngIf="place">

  <!-- üåç MODE LECTURE (affichage simple) -->
  <ion-card *ngIf="!isEditing">
    <ion-card-header>
      <ion-card-title>{{ place.name }}</ion-card-title>
      <ion-card-subtitle>{{ place.category }}</ion-card-subtitle>
    </ion-card-header>

    <ion-card-content>
      <p><strong>Adresse :</strong> {{ place.address }}</p>
      <p *ngIf="place.phone"><strong>T√©l√©phone :</strong> {{ place.phone }}</p>
      <p>
        <strong>Coordonn√©es GPS :</strong> {{ place.lat }}, {{ place.lng }}
      </p>
      <p *ngIf="place.note"><strong>Note :</strong> {{ place.note }}</p>

      <ion-button
        expand="block"
        *ngIf="place.phone"
        [href]="'tel:' + place.phone">
        Appeler
      </ion-button>

      <ion-button
        expand="block"
        fill="outline"
        [href]="'https://www.google.com/maps/search/?api=1&query=' + place.lat + ',' + place.lng"
        target="_blank">
        Ouvrir dans Google Maps
      </ion-button>

      <ion-button
        expand="block"
        color="primary"
        (click)="enableEdit()"
        [disabled]="!canEdit">
        Modifier
      </ion-button>

      <ion-button
        expand="block"
        color="danger"
        (click)="deletePlace()">
        Supprimer
      </ion-button>
    </ion-card-content>
  </ion-card>

  <!-- ‚úèÔ∏è MODE √âDITION -->
  <ion-card *ngIf="isEditing">
    <ion-card-header>
      <ion-card-title>Modifier le lieu</ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <form [formGroup]="form" (ngSubmit)="saveChanges()">

        <ion-item>
          <ion-input
            label="Nom"
            label-placement="floating"
            formControlName="name">
          </ion-input>
        </ion-item>

        <ion-item>
          <ion-select
            label="Cat√©gorie"
            formControlName="category">
            <ion-select-option value="hopital">H√¥pital</ion-select-option>
            <ion-select-option value="police">Police</ion-select-option>
            <ion-select-option value="bibliotheque">Biblioth√®que</ion-select-option>
            <ion-select-option value="wifi">Point Wi-Fi</ion-select-option>
            <ion-select-option value="autre">Autre</ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item>
          <ion-input
            label="Adresse"
            label-placement="floating"
            formControlName="address">
          </ion-input>
        </ion-item>

        <ion-item>
          <ion-input
            label="T√©l√©phone"
            type="tel"
            label-placement="floating"
            formControlName="phone">
          </ion-input>
        </ion-item>

        <ion-item>
          <ion-input
            label="Latitude"
            type="number"
            label-placement="floating"
            formControlName="lat">
          </ion-input>
        </ion-item>

        <ion-item>
          <ion-input
            label="Longitude"
            type="number"
            label-placement="floating"
            formControlName="lng">
          </ion-input>
        </ion-item>

        <!-- Bouton GPS pour mettre √† jour lat/lng en mode √©dition -->
        <ion-button
          type="button"
          expand="block"
          class="ion-margin-vertical"
          (click)="useCurrentLocationForEdit()"
          [disabled]="loadingLocation">
          {{ loadingLocation ? 'Localisation en cours...' : 'Utiliser ma position actuelle' }}
        </ion-button>

        <ion-item>
          <ion-textarea
            label="Note"
            label-placement="stacked"
            formControlName="note">
          </ion-textarea>
        </ion-item>

        <ion-button
          expand="block"
          type="submit"
          [disabled]="form.invalid">
          Enregistrer les modifications
        </ion-button>

        <ion-button
          expand="block"
          fill="outline"
          type="button"
          (click)="cancelEdit()">
          Annuler
        </ion-button>
      </form>
    </ion-card-content>
  </ion-card>

</ion-content>
